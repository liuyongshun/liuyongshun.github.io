<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>七月</title>
  <meta name="baidu-site-verification" content="vdMfpFtVYF">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="Smiple, 简, jian, 简博客">
  <meta name="description" content="得与失之间，是我所有的美好和思念">
<meta name="keywords" content="Smiple, 简, jian, 简博客">
<meta property="og:type" content="website">
<meta property="og:title" content="七月">
<meta property="og:url" content="http://liuyongshun.github.io/page/22/index.html">
<meta property="og:site_name" content="七月">
<meta property="og:description" content="得与失之间，是我所有的美好和思念">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="七月">
<meta name="twitter:description" content="得与失之间，是我所有的美好和思念">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

  <script></script>
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">七月</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">是七月呀</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/link">链接</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://liuyongshun.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-npm" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/27/npm/" class="article-date">
  <time datetime="2019-04-27T08:29:00.000Z" itemprop="datePublished">2019-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/NPM/">NPM</a>►<a class="article-category-link" href="/categories/NPM/npm-package/">npm package</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/27/npm/">npm</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、发布npm包"><a href="#一、发布npm包" class="headerlink" title="一、发布npm包"></a>一、发布npm包</h3><ol>
<li><p>注册npm用户</p>
</li>
<li><p>在本地开发内容</p>
</li>
<li><p>在该文件内执行npm login 登陆用户</p>
</li>
<li><p>npm publish 发布自己开发完成的包</p>
</li>
</ol>
<p>注册没什么好说的，直接略过，主要说如何开发以及发布中可能遇到哪些问题。</p>
<h3 id="一、基础"><a href="#一、基础" class="headerlink" title="一、基础"></a>一、基础</h3><h4 id="1-1-基础配置"><a href="#1-1-基础配置" class="headerlink" title="1.1 基础配置"></a>1.1 基础配置</h4><p><strong>建议优先建立github线上库，同时写个README.md 然后直接克隆下来。如果在本地文件内直接npm init 后面package.json的内容还要自己填写。</strong></p>
<ul>
<li><p>github 创建仓库，生成readme.md</p>
</li>
<li><p>克隆完库之后npm init 因为有.git的存在，homepage ，bugs， repository的地址都会默认填充好。</p>
</li>
<li><p>设计项目的目录结构，这个看自己设计了。常见的src 源文件，lib打包后输出的文件。</p>
</li>
</ul>
<h4 id="1-2-package-json字段解释，需要了解。"><a href="#1-2-package-json字段解释，需要了解。" class="headerlink" title="1.2 package.json字段解释，需要了解。"></a>1.2 package.json字段解释，需要了解。</h4><ul>
<li><p>scripts: 指定了运行脚本命令的npm命令行缩写，比如start指定了运行npm run start时，所要执行的命令。</p>
</li>
<li><p>version: npm 每次从新发包时，必须要改版本号，不然报错。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">升级补丁版本号：npm version patch</span><br><span class="line"></span><br><span class="line">升级小版本号：npm version minor</span><br><span class="line"></span><br><span class="line">升级大版本号：npm version major</span><br></pre></td></tr></table></figure>
<ul>
<li><p>dependencies： 字段指定了项目运行所依赖的模块。</p>
</li>
<li><p>devDependencies： 指定项目开发所需要的模块。</p>
</li>
<li><p>dependencies 和devDependencies中，~1.2.2，表示安装1.2.x的最新版本（不低于1.2.2），但是不安装1.3.x。</p>
</li>
<li><p>dependencies 和devDependencies中，^1.2.2，表示安装1.x.x的最新版本（不低于1.2.2），但是不安装2.x.x。</p>
</li>
<li><p>dependencies 和devDependencies中，latest：安装最新版本。</p>
</li>
<li><p>peerDependencies字段，就是用来供插件指定其所需要的主工具的版本</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;chai-as-promised&quot;,</span><br><span class="line">  &quot;peerDependencies&quot;: &#123;</span><br><span class="line">    &quot;chai&quot;: &quot;1.x&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">安装chai-as-promised模块时，主程序chai必须一起安装，而且chai的版本必须是1.x。如果你的项目指定的依赖是chai的2.0版本，就会报错。</span><br></pre></td></tr></table></figure>
<ul>
<li>bin字段 bin项用来指定各个内部命令对应的可执行文件的位置。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><p>main字段指定了加载的入口文件，require(‘moduleName’)或import就会加载这个文件。一般会指向打包完的文件里。</p>
</li>
<li><p>config 字段</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;foo&quot;,</span><br><span class="line">  &quot;config&quot; : &#123; &quot;port&quot; : &quot;8080&quot; &#125;,</span><br><span class="line">  &quot;scripts&quot; : &#123; &quot;start&quot; : &quot;node server.js&quot; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// server.js </span><br><span class="line">http</span><br><span class="line">  .createServer(...)</span><br><span class="line">  .listen(process.env.npm_package_config_port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  用户执行npm run start命令时，这个脚本就可以得到值。</span><br></pre></td></tr></table></figure>
<ul>
<li><p>browser字段 browser指定该模板供浏览器使用的版本。Browserify这样的浏览器打包工具，通过它就知道该打包那个文件。</p>
</li>
<li><p>engines 字段字段指明了该模块运行的平台，比如 Node 的某个版本或者浏览器。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;engines&quot; : &#123; &quot;node&quot; : &quot;&gt;=0.10.3 &lt;0.12&quot; &#125; &#125;</span><br></pre></td></tr></table></figure>
<h3 id="二、开发规范"><a href="#二、开发规范" class="headerlink" title="二、开发规范"></a>二、开发规范</h3><h4 id="2-1-代码规范eslint"><a href="#2-1-代码规范eslint" class="headerlink" title="2.1 代码规范eslint"></a>2.1 代码规范eslint</h4><p><strong>使用eslint:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint -g</span><br><span class="line">eslint init</span><br></pre></td></tr></table></figure>
<p>根据 eslint 提供的选项结合自己的需求，一路选择后，生成.eslintrc.js文件，里面是一系列的规则配置。有eslintrc配置文件，编辑器才会生效提示。</p>
<p><strong>Sublime Text3：</strong> 需要安装插件 Sublime​Linter 和 SublimeLinter-contrib-eslint。才可以自动提示eslint语法错误。</p>
<p><strong>vscode：</strong>  安装eslint 插件即可。</p>
<p><strong>脚本命令： </strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;lint&quot;: &quot;eslint --fix src&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">npm run lint  // 执行代码eslint检测，对于一些简单错误，例如多了空行，他会自动删除，复杂错误会抛出来。</span><br></pre></td></tr></table></figure>
<p>如果某些目录不想使用校验，可以创建一个 .eslintignore，把不需要校验的目录放进入。语法和gitignore类似。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// .eslintignore</span><br><span class="line"></span><br><span class="line">/node_modules/</span><br><span class="line">/lib/</span><br></pre></td></tr></table></figure>
<p><strong>Tips: </strong></p>
<ul>
<li><p>window 下创建隐藏文件：<code>.eslintignore.</code></p>
</li>
<li><p>mac 下直接 touch .eslintignore</p>
</li>
</ul>
<h4 id="2-2-git-hook-搭配eslint校验"><a href="#2-2-git-hook-搭配eslint校验" class="headerlink" title="2.2 git hook 搭配eslint校验"></a>2.2 git hook 搭配eslint校验</h4><h4 id="2-2-1-使用-husky插件，规范提交"><a href="#2-2-1-使用-husky插件，规范提交" class="headerlink" title="2.2.1 使用 husky插件，规范提交"></a>2.2.1 使用 husky插件，规范提交</h4><p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install husky --save-dev</span><br></pre></td></tr></table></figure>
<p>配置：在package.json的script</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;precommit&quot;: &quot;./node_modules/.bin/eslint --ext .jsx,.js ./&quot;,</span><br><span class="line">&quot;prepush&quot;: &quot;./node_modules/.bin/eslint --ext .jsx,.js ./&quot;,</span><br><span class="line">&quot;eslint_fix&quot;: &quot;./node_modules/.bin/eslint --fix  --ext .jsx,.js ./&quot;,</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<ul>
<li><p>eslint是否全局安装，对脚本执行的写法是有影响的。上面的代码执行的是局部安装的eslint</p>
</li>
<li><p>在commit之前，如果有不符合eslint规范的代码时无法提交的。也无法推到远程库。</p>
</li>
</ul>
<h4 id="2-2-2-husky-lint-staged-对提交内容进行规范"><a href="#2-2-2-husky-lint-staged-对提交内容进行规范" class="headerlink" title="2.2.2 husky + lint-staged 对提交内容进行规范"></a>2.2.2 husky + lint-staged 对提交内容进行规范</h4><p>对于一些以前从来没有用过eslint的项目来说.突然引入这种工具。你可能面临的是把所有文件都按照eslint都格式化一遍。</p>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install lint-staged --save-dev</span><br></pre></td></tr></table></figure>
<p>package.json 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">   &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">   &quot;build&quot;: &quot;webpack&quot;,</span><br><span class="line">   &quot;start&quot;: &quot;webpack-dev-server --inline&quot;,</span><br><span class="line">   &quot;api&quot;: &quot;node api/server.js&quot;,</span><br><span class="line">   &quot;precommit&quot;: &quot;lint-staged&quot;</span><br><span class="line"> &#125;,</span><br><span class="line"> &quot;lint-staged&quot;: &#123;</span><br><span class="line">   // 文件目录</span><br><span class="line">   &quot;src/**/*.js&quot;: &quot;eslint&quot;</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-husky-lint-staged-prettier-自动格式化代码"><a href="#2-2-2-husky-lint-staged-prettier-自动格式化代码" class="headerlink" title="2.2.2 husky + lint-staged + prettier 自动格式化代码"></a>2.2.2 husky + lint-staged + prettier 自动格式化代码</h4><p>在上面的基础上加入自动格式化代码。格式化不了的在抛出错误。该功能可能在格式化的时候还需要额外配置，或者格式化的代码并不是完全符合eslint。反而鸡肋了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;webpack&quot;,</span><br><span class="line">  &quot;start&quot;: &quot;webpack-dev-server --inline&quot;,</span><br><span class="line">  &quot;api&quot;: &quot;node api/server.js&quot;,</span><br><span class="line">  &quot;precommit&quot;: &quot;lint-staged&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;lint-staged&quot;: &#123;</span><br><span class="line">  &quot;src/**/*.js&quot;: [</span><br><span class="line">    &quot;eslint --fix --ext .js&quot;,</span><br><span class="line">    &quot;prettier --write&quot;,</span><br><span class="line">    &quot;git add&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<ul>
<li><p>为了和eslint配合使用需要引入两个插件eslint-plugin-prettier和eslint-config-prettier。</p>
</li>
<li><p>因为 ESLint 和 Prettier 都可以格式化代码，如果他们对格式化代码执行不同规则，那就可能发生冲突，可以通过配置解决大部分冲突，如下配置。</p>
</li>
<li><p>eslint-plugin-prettier，它会对比格式化前和用 Prettier 格式化后的代码，有不一致的地方就会报错提示。</p>
</li>
<li><p>两者混合使用时候，需要修改规则，以防止重复或冲突；eslint-config-prettier 即为解决此问题的存在，可以使用它关闭所有可能引起冲突的规则。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// .prettierrc.js 文件</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  printWidth: 80,</span><br><span class="line">  semi: true,</span><br><span class="line">  singleQuote: true,</span><br><span class="line">  trailingComma: &apos;none&apos;,</span><br><span class="line">  bracketSpacing: true,</span><br><span class="line">  jsxBracketSameLine: false,</span><br><span class="line">  arrowParens: &apos;avoid&apos;,</span><br><span class="line">  requirePragma: false,</span><br><span class="line">  proseWrap: &apos;preserve&apos;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>但仍有一些是无法解决的，比如，Prettier 在 function 关键字后不允许有空格且不能自定义，那如果想避免 ESLint 不报错，只能配置 ESLint 允许 function 关键字后不带空格（主要针对匿名函数）。如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function aa () &#123;</span><br><span class="line">  console.log(3333);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">会被格式化下面这种，但是函数名与括弧间没有空格是不符合eslint。</span><br><span class="line"></span><br><span class="line">function aa() &#123;</span><br><span class="line">  console.log(3333);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>其实通过前两种方式，已经算是解决规范问题了，第三种不过是扩充，而且存在不稳定性和非预期错误的产生，以及对规则的配置。本想提高产出，但是却额外增加了学习成本和时间成本，有点鸡肋。</strong></p>
<h4 id="2-3-git的分支策略"><a href="#2-3-git的分支策略" class="headerlink" title="2.3 git的分支策略"></a>2.3 git的分支策略</h4><p><strong>线上分支：</strong></p>
<ol>
<li><p>master 主分支，用来管理当前部署在线上的应用版本。提供回退备份机制。</p>
</li>
<li><p>dev  分支，用来管理接下来要开发的内容版本。</p>
</li>
<li><p>fixbug 分支，用来处理紧急bug的分支。</p>
</li>
</ol>
<ul>
<li><p>用dev分支发布最新开发完成的内容，master作为回退备份。可以保证当发布线上出现重大问题后，退到上一个线上稳定版本。</p>
</li>
<li><p>用fixbug分支作为bug处理，可以保证bug和当前开放内容分开处理，并快速开发上线。</p>
</li>
<li><p>不论dev还是fixbug，只要新的迭代内容发布到线上通过测试后，都要及时合并到主分支。</p>
</li>
</ul>
<p><strong>本地分支：</strong></p>
<p>本地分支个人开发习惯是，temp分支用来开发，backup分支用来备份开发前的内容，然后定期merge分支。</p>
<p>单独出来一份temp分支的好处：</p>
<ol>
<li><p>当我想pull代码时，必然要切换分支，这时候必须进行两种操作之一，commit代码或git stash 暂存修改内容。无论哪种都是比较好的操作，都能避免误操作checkout丢失内容，无法找回。</p>
</li>
<li><p>冲突不会发生在pull阶段，而是在merge阶段。在pull代码时冲突，处理不好的话，也会产生数据错误或丢失，另外temp分支可以备份内容，然后废弃。</p>
</li>
</ol>
<h4 id="2-4-钉钉机器人和git"><a href="#2-4-钉钉机器人和git" class="headerlink" title="2.4 钉钉机器人和git"></a>2.4 钉钉机器人和git</h4><p>将git的提交动作和钉钉群里机器人关联，并通知到群里。可以为协同开发提供一个反馈机制。</p>
<p>进入 GitHub 代码库，依次点击「Settings」、「Webhooks &amp; Services」、「Add Webhook」</p>
<p><a href="https://open-doc.dingtalk.com/microapp/serverapi2/ytwu0l" target="_blank" rel="noopener">钉钉文档</a></p>
<h3 id="三、设计包内容"><a href="#三、设计包内容" class="headerlink" title="三、设计包内容"></a>三、设计包内容</h3><h4 id="3-1-目录结构设计"><a href="#3-1-目录结构设计" class="headerlink" title="3.1 目录结构设计"></a>3.1 目录结构设计</h4><p><strong>包可简可复杂，目录设计可以根据需求敲定，package.json 中main指定输出，保证功能正常提供即可。</strong></p>
<p>常见的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">|-- bin/  命令脚本文件</span><br><span class="line">|-- lib/  打包后的输出文件</span><br><span class="line">|-- test/ 测试</span><br><span class="line">|-- src/  源文件</span><br><span class="line">|-- package.json</span><br><span class="line">|-- README.md</span><br><span class="line">|-- ··· more</span><br></pre></td></tr></table></figure>
<h4 id="3-2-开发基本思路"><a href="#3-2-开发基本思路" class="headerlink" title="3.2 开发基本思路"></a>3.2 开发基本思路</h4><ol>
<li><strong>高内聚，低耦合</strong>  功能性组件开发</li>
<li><strong>可拓展性</strong>       不是单个方法类的包都需要考虑拓展性</li>
<li><strong>兼容性</strong>         es6语法的处理，或者其他兼容性问题</li>
<li><strong>按需加载</strong>       功能复杂，庞大的组件按需加载能提供更好的体验</li>
<li><strong>说明文档</strong>       没说明，没人知道包是干嘛的</li>
</ol>
<h4 id="3-3-单元测试"><a href="#3-3-单元测试" class="headerlink" title="3.3 单元测试"></a>3.3 单元测试</h4><p><strong>定义：</strong></p>
<p>单元测试是针对程序模块（软件设计的最小单位）来进行正确性检验的测试工作。在过程化编程中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是方法，包括基类（超类）、抽象类、或者派生类（子类）中的方法。</p>
<p><strong>作用：</strong></p>
<p>消除程序单元的不可靠，采用自底向上的测试路径。通过先测试程序部件再测试部件组装，使集成测试变得更加简单。</p>
<p><strong>模式：</strong></p>
<p>BDD: 行为驱动开发，它鼓励软件项目中的开发者、 QA和非技术人员或商业参与者之间的协作。主要是从用户的需求出发，强调系统行为。</p>
<p>TDD: 测试驱动开发，TDD的原理是在开发功能代码之前，先编写单元测试用例代码，测试代码确定需要编写什么产品代码。TDD的基本思路就是通过测试来推动整个开发的进行，但测试驱动开发并不只是单纯的测试工作，而是把需求分析，设计，质量控制量化的过程。</p>
<p>karma + mocha + power-assert + karma-coverage-istanbul-reporter  <a href="https://juejin.im/post/5a5f91f25188257345019008" target="_blank" rel="noopener">参考</a></p>
<p>karma： 一个测试运行器，搭配插件用于启动浏览器，运行测试案例并将结果报告给我们。该工具的主要作用是将项目运行在各种主流Web浏览器进行测试。</p>
<p>Mocha：一个测试框架。可结合chai断言库使用。</p>
<p>power-assert：一个测试断言库，提供了更好的断言语法。</p>
<p>karma-coverage-istanbul-reporter ： 测试覆盖报告。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">安装：</span><br><span class="line">npm install karma-cli -g</span><br><span class="line"></span><br><span class="line">其他库和依赖：</span><br><span class="line">npm install karma mocha power-assert karma-coverage-istanbul-reporter istanbul-instrumenter-loader</span><br><span class="line"></span><br><span class="line">初始化：</span><br><span class="line">karma init karma.conf.js</span><br><span class="line"></span><br><span class="line">// karma.conf.js </span><br><span class="line"></span><br><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line">module.exports = function(config) &#123;</span><br><span class="line">  config.set(&#123;</span><br><span class="line">    // 基础路径，用在files，exclude属性上</span><br><span class="line">    basePath: &apos;&apos;,</span><br><span class="line">    // 表示可以在测试文件中不需引入即可使用两个库的全局方法</span><br><span class="line">    frameworks: [&apos;mocha&apos;, &apos;power-assert&apos;],</span><br><span class="line">    files: [</span><br><span class="line">        &apos;./test/index.js&apos;</span><br><span class="line">    ],</span><br><span class="line">    exclude: [</span><br><span class="line">    ],</span><br><span class="line">    preprocessors: &#123;</span><br><span class="line">        &apos;./test/index.js&apos;: [&apos;webpack&apos;, &apos;sourcemap&apos;]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    reporters: [&apos;spec&apos;, &apos;coverage-istanbul&apos;],</span><br><span class="line">    port: 9876,</span><br><span class="line">    colors: true,</span><br><span class="line">    /**</span><br><span class="line">    * 日志等级</span><br><span class="line">    * 可能的值：</span><br><span class="line">    * config.LOG_DISABLE  //不输出信息</span><br><span class="line">    * config.LOG_ERROR    //只输出错误信息</span><br><span class="line">    * config.LOG_WARN     //只输出警告信息</span><br><span class="line">    * config.LOG_INFO     //输出全部信息</span><br><span class="line">    * config.LOG_DEBUG    //输出调试信息</span><br><span class="line">    */</span><br><span class="line">    logLevel: config.LOG_INFO,</span><br><span class="line">    // 启用或禁用自动检测文件变化进行测试， 如果为false。测试运行需要两步，karma start darma.conf.js 然后在启动terminal运行karma run</span><br><span class="line">    autoWatch: true,</span><br><span class="line">    browsers: [&apos;Chrome&apos;],</span><br><span class="line"></span><br><span class="line">    coverageReporter: &#123;</span><br><span class="line">      dir: &apos;./coverage&apos;, // 覆盖率结果文件放./coverage 文件夹中</span><br><span class="line">      type: &apos;html&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    webpack: &#123;</span><br><span class="line">      output: &#123;</span><br><span class="line">        path: __dirname + &apos;/dev&apos;,</span><br><span class="line">        filename: &apos;[name].js&apos;,</span><br><span class="line">        libraryTarget: &apos;umd&apos;</span><br><span class="line">      &#125;,</span><br><span class="line">      module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">           &#123;</span><br><span class="line">             test: /\.js$/,</span><br><span class="line">             use: &#123;</span><br><span class="line">                loader: &apos;istanbul-instrumenter-loader&apos;,</span><br><span class="line">                options: &#123; esModules: true &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">             enforce: &apos;post&apos;,</span><br><span class="line">             include: path.resolve(&apos;./src&apos;)</span><br><span class="line">           &#125;</span><br><span class="line">         ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    webpackMiddleware: &#123;</span><br><span class="line">      noInfo: false</span><br><span class="line">    &#125;,</span><br><span class="line">    singleRun: false,</span><br><span class="line">    concurrency: Infinity</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// package.json全部依赖</span><br><span class="line"></span><br><span class="line">  &quot;abbrev&quot;: &quot;^1.1.1&quot;,</span><br><span class="line">  &quot;array-find-index&quot;: &quot;^1.0.2&quot;,</span><br><span class="line">  &quot;babel-cli&quot;: &quot;^6.26.0&quot;,</span><br><span class="line">  &quot;babel-core&quot;: &quot;^6.26.3&quot;,</span><br><span class="line">  &quot;babel-eslint&quot;: &quot;^10.0.1&quot;,</span><br><span class="line">  &quot;babel-loader&quot;: &quot;^7.1.5&quot;,</span><br><span class="line">  &quot;babel-plugin-istanbul&quot;: &quot;^5.1.4&quot;,</span><br><span class="line">  &quot;babel-preset-es2015&quot;: &quot;^6.24.1&quot;,</span><br><span class="line">  &quot;babel-preset-power-assert&quot;: &quot;^3.0.0&quot;,</span><br><span class="line">  &quot;babel-register&quot;: &quot;^6.26.0&quot;,</span><br><span class="line">  // 生成 coveralls</span><br><span class="line">  &quot;coveralls&quot;: &quot;^3.0.3&quot;,</span><br><span class="line">  &quot;cross-env&quot;: &quot;^5.2.0&quot;,</span><br><span class="line">  &quot;eslint&quot;: &quot;^5.16.0&quot;,</span><br><span class="line">  &quot;eslint-config-standard&quot;: &quot;^12.0.0&quot;,</span><br><span class="line">  &quot;eslint-plugin-import&quot;: &quot;^2.17.2&quot;,</span><br><span class="line">  &quot;eslint-plugin-node&quot;: &quot;^8.0.1&quot;,</span><br><span class="line">  &quot;eslint-plugin-promise&quot;: &quot;^4.1.1&quot;,</span><br><span class="line">  &quot;eslint-plugin-standard&quot;: &quot;^4.0.0&quot;,</span><br><span class="line">  // git commit push hook。 搭配eslint做代码检测</span><br><span class="line">  &quot;husky&quot;: &quot;^1.3.1&quot;,</span><br><span class="line">  &quot;istanbul-instrumenter-loader&quot;: &quot;^3.0.1&quot;,</span><br><span class="line">  &quot;karma&quot;: &quot;^4.1.0&quot;,</span><br><span class="line">  // 启动浏览器</span><br><span class="line">  &quot;karma-chrome-launcher&quot;: &quot;^2.2.0&quot;,</span><br><span class="line">  // 生成测试覆盖文件html。lcov.info</span><br><span class="line">  &quot;karma-coverage-istanbul-reporter&quot;: &quot;^2.0.5&quot;,</span><br><span class="line">  &quot;karma-espower-preprocessor&quot;: &quot;^1.2.0&quot;,</span><br><span class="line">  &quot;karma-mocha&quot;: &quot;^1.3.0&quot;,</span><br><span class="line">  // 搭配mocha生成测试报告</span><br><span class="line">  &quot;karma-mocha-reporter&quot;: &quot;^2.2.5&quot;,</span><br><span class="line">  &quot;karma-power-assert&quot;: &quot;^1.0.0&quot;,</span><br><span class="line">  &quot;karma-sourcemap-loader&quot;: &quot;^0.3.7&quot;,</span><br><span class="line">  &quot;karma-spec-reporter&quot;: &quot;^0.0.32&quot;,</span><br><span class="line">  &quot;karma-webpack&quot;: &quot;^3.0.5&quot;,</span><br><span class="line">  &quot;mocha&quot;: &quot;^6.1.4&quot;,</span><br><span class="line">  &quot;nopt&quot;: &quot;^4.0.1&quot;,</span><br><span class="line">  // 生成测试覆盖率工具</span><br><span class="line">  &quot;nyc&quot;: &quot;^14.1.1&quot;,</span><br><span class="line">  // 断言库</span><br><span class="line">  &quot;power-assert&quot;: &quot;^1.6.1&quot;,</span><br><span class="line">  &quot;webpack&quot;: &quot;^3.0.0&quot;</span><br></pre></td></tr></table></figure>
<p><strong>问题：</strong></p>
<p><strong>希望测试文件也类似src源文件一样，一个入口index.js，其他的采用es6模块引入，切支持es6语法。（node 是 CommonJS规范，没办法直接用）。</strong></p>
<ul>
<li>test目录下建立index.js, karma.conf.js 的file指到index.js</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// test/index.js 配置  istanbul-instrumenter-loader 插件搭配webpack实现es6的modules</span><br><span class="line"></span><br><span class="line">// require all test files that ends with .spec.js</span><br><span class="line">const testsContext = require.context(&apos;./&apos;, true, /\.spec$/)</span><br><span class="line">testsContext.keys().forEach(testsContext)</span><br><span class="line"></span><br><span class="line">// require all src files for coverage.</span><br><span class="line">const srcContext = require.context(&apos;../src&apos;, true, /index\.js$/)</span><br><span class="line">srcContext.keys().forEach(srcContext)</span><br></pre></td></tr></table></figure>
<ul>
<li>支持es6语法，babel套餐不能少。</li>
</ul>
<p>在.babelrc 文件中加入以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [</span><br><span class="line">    &quot;es2015&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>配置如上karma.conf.js的webpack内容。</li>
</ul>
<p><strong>挖坑问题：</strong></p>
<p>在最开始测试覆盖和报告采用karma + karma-coverage-istanbul-reporter + karma-chrome-launcher + mocha + power-assert 生成, 每次npm run test 都会生成测试报告，并启动浏览器。</p>
<p>这种测试方式适合在本地执行，并且测试内容对浏览器兼容有要求。如果将这种模式放到Travis-CI 里构建是不行的。因为Travis-CI 无法启动浏览器，测试脚本永远执行不通过，导致3.4.2的Coveralls 测试覆盖率badge无法生成。</p>
<p>所以该项目里用了两套单元测试一套用来构建的Coveralls生成badge。一套用来构建本地测试。script 脚本里test是本地测试用，cover是用来放到Travis-CI构建的hook里。</p>
<ol>
<li>nyc + mocha + karma-mocha-reporter + power-assert + babel-core + babel-register + coveralls (生成测试覆盖率)</li>
<li>karma + mocha + power-assert + webpack + babel（套装） + istanbul-instrumenter-loader + karma-power-assert + karma-coverage-istanbul-reporter + karma-chrome-launcher（本地）</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;test&quot;: &quot;karma start karma.conf.js&quot;,</span><br><span class="line">  &quot;precommit&quot;: &quot;./node_modules/.bin/eslint --ext .jsx,.js ./&quot;,</span><br><span class="line">  &quot;prepush&quot;: &quot;./node_modules/.bin/eslint --ext .jsx,.js ./&quot;,</span><br><span class="line">  &quot;eslint_fix&quot;: &quot;./node_modules/.bin/eslint --fix  --ext .jsx,.js ./&quot;,</span><br><span class="line">  &quot;buildes5&quot;: &quot;babel src -d lib&quot;,</span><br><span class="line">  &quot;cover&quot;: &quot;nyc --reporter=lcov --reporter=text-summary ./node_modules/mocha/bin/_mocha --reporter spec --require babel-core/register ./test/**/*.spec.js&quot;,</span><br><span class="line">  &quot;coveralls&quot;: &quot;cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js&quot;,</span><br><span class="line">  &quot;lint&quot;: &quot;eslint --fix src&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;babel src --out-file script-compiled.js&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="3-4-持续集成"><a href="#3-4-持续集成" class="headerlink" title="3.4 持续集成"></a>3.4 持续集成</h3><p><img src="https://user-gold-cdn.xitu.io/2019/6/1/16b112da0fc0c35b?w=487&amp;h=115&amp;f=png&amp;s=10538" alt></p>
<p><strong>关于持续集成：</strong>持续集成的目的，就是让产品可以快速迭代，同时还能保持高质量。它的核心措施是，代码集成到主干之前，必须通过自动化测试。只要有一个测试用例失败，就不能集成，持续集成并不能消除Bug，而是让它们非常容易发现和改正。</p>
<p>3.4.1 Travis-CI </p>
<p>github授权登陆，打开对应的库，如下图。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/1/16b112f548b55e40?w=1195&amp;h=529&amp;f=png&amp;s=61918" alt></p>
<p>自动化构建工具类似jenkins，集成测试的相关命令，每次push后执行测试脚本，测试通过生成报告，配合Coveralls.io生成测试覆盖率。用github授权登陆。</p>
<p><a href="https://travis-ci.org/" target="_blank" rel="noopener">Travis-CI</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// .travis.yml  配置</span><br><span class="line"># 使用的语言</span><br><span class="line">language: node_js</span><br><span class="line"></span><br><span class="line"># node的版本</span><br><span class="line">node_js:</span><br><span class="line">  - 10.8.0</span><br><span class="line"></span><br><span class="line"># 仓库的分支</span><br><span class="line">branches:</span><br><span class="line">  only:</span><br><span class="line">  - master</span><br><span class="line"></span><br><span class="line"># 执行install方法</span><br><span class="line">install:</span><br><span class="line">- npm install</span><br><span class="line"></span><br><span class="line"># 执行脚本命令</span><br><span class="line">script:</span><br><span class="line">  - npm run lint</span><br><span class="line">  - npm run buildes5</span><br><span class="line">  - npm run cover</span><br><span class="line"></span><br><span class="line"># 成功后执行</span><br><span class="line">after_success:</span><br><span class="line">- npm run coveralls</span><br></pre></td></tr></table></figure>
<p>3.4.2 Coveralls.io</p>
<p><a href="https://coveralls.io/" target="_blank" rel="noopener">Coveralls.io</a>  github授权登陆，然后打开所开发的内容库，如下图。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/1/16b112e147a51555?w=1199&amp;h=725&amp;f=png&amp;s=217694" alt></p>
<p>上面Travis-CI是持续集成的构建工具，Coveralls.io网站 + npm包（coveralls + nyc + mocha + power-assert）可以在travis-ci构建执行测试并生成测试覆盖率。</p>
<ol>
<li><p>安装相关的npm包</p>
</li>
<li><p>package.json 配置script 命令如下</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 生成测试报告（测试覆盖率）文件： nyc --reporter=lcov --reporter=text-summary</span><br><span class="line"></span><br><span class="line">// 执行mocha测试 --reporter 是在termimal生成测试覆盖信息，--require babel-core/register 支持es6语法和es6的modules  ./node_modules/mocha/bin/_mocha --reporter spec --require babel-core/register </span><br><span class="line"></span><br><span class="line">// test下的是全部的测试用例格式 .spec.js</span><br><span class="line"></span><br><span class="line">&quot;cover&quot;: &quot;nyc --reporter=lcov --reporter=text-summary ./node_modules/mocha/bin/_mocha --reporter spec --require babel-core/register ./test/**/*.spec.js&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 通过coveralls工具将测试通过生成的lcov.info测试报告，关联到Coveralls.io，最后生成测试覆盖率的badge图标。</span><br><span class="line"></span><br><span class="line">&quot;coveralls&quot;: &quot;cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js&quot;,</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>将npm run cover 命令配置到.travis.yml的 script 的hook 下面，每当git push代码，都会执行script下的命令。</p>
</li>
<li><p>将npm run coveralls 命令配置到.travis.yml 的 after_success的hook下面，每当script脚本都执行成功后，执行after_success下的脚本命令。</p>
</li>
</ol>
<p>3.4.3 shields</p>
<p><a href="https://shields.io/" target="_blank" rel="noopener">shields</a> 的网站下有已存在的很多类型。例如download， license ，star 等badge，例如： 点击 Download — 找到npm的图标 — 点击图标 — 配置选择（周，月，年）下载 - 输入自己的npm包名字 — 复制markdown url 然后拷贝到 README.md 里即可完成。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/1/16b1132807064e70?w=794&amp;h=521&amp;f=png&amp;s=35201" alt></p>
<p>将自己的发布的npm包的名字拷贝上去即可，复制markdown url放到自己readme.md上。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/1/16b1132c8c49902b?w=652&amp;h=436&amp;f=png&amp;s=32901" alt></p>
<h3 id="四、发布及注意事项"><a href="#四、发布及注意事项" class="headerlink" title="四、发布及注意事项"></a>四、发布及注意事项</h3><h4 id="4-1-发布"><a href="#4-1-发布" class="headerlink" title="4.1 发布"></a>4.1 发布</h4><p><strong>安装有cnpm</strong></p>
<p>安装有cnpm时，需要注意切换到npm库在登陆发布。</p>
<p>操作步骤：</p>
<p>查看当前连接的库：<code>npm config get registry</code></p>
<p>如果当前连接在淘宝镜像，设置连接到npm： <code>npm config set registry=http://registry.npmjs.org</code></p>
<p>登陆npm ： <code>npm login</code></p>
<p>修改版本号（每次发布必须修改）： <code>npm version patch</code> 或 <code>npm version minor</code>  或 <code>npm version major</code> </p>
<p>版本号遵循：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">patch：小变动，比如修复bug等，版本号变动 v1.0.0-&gt;v1.0.1</span><br><span class="line"></span><br><span class="line">minor：增加新功能，不影响现有功能,版本号变动 v1.0.0-&gt;v1.1.0</span><br><span class="line"></span><br><span class="line">major：破坏模块对向后的兼容性，版本号变动 v1.0.0-&gt;v2.0.0</span><br></pre></td></tr></table></figure>
<p>发布： <code>npm publish</code></p>
<p>发布完成切回淘宝镜像： <code>npm config set registry=https://registry.npm.taobao.org</code></p>
<p><strong>没有cnpm</strong></p>
<p>在上面的步骤去掉关于cnpm的切换操作即可。</p>
<p><strong>Tips: </strong></p>
<ol>
<li>npm publish 时，我们不希望把没用的内容发布上去。</li>
</ol>
<p>&#x3000;&#x3000; 黑名单：可以建立<code>.npmignore</code>把不要的文件排除。</p>
<p>&#x3000;&#x3000; 白名单：可以在pakeage.json里的添加files字段指定要发布的文件。</p>
<p>参考资料：</p>
<p><a href="https://docs.npmjs.com/files/package.json" target="_blank" rel="noopener">package.json</a><br><a href="https://javascript.ruanyifeng.com/nodejs/packagejson.html" target="_blank" rel="noopener">package.json</a><br><a href="https://harttle.land/2016/04/30/github-ci.html#header-2" target="_blank" rel="noopener">持续集成</a><br><a href="https://juejin.im/post/5a9e3d846fb9a028be3582fb" target="_blank" rel="noopener">持续集成</a><br><a href="https://www.404forest.com/2017/02/22/use-karma-mocha-kits-to-write-unit-tests-for-vue-component/" target="_blank" rel="noopener">单元测试</a><br><a href="https://juejin.im/post/5a5f91f25188257345019008" target="_blank" rel="noopener">单元测试</a><br><a href="https://juejin.im/post/5b231f6ff265da595f0d2540" target="_blank" rel="noopener">发npm</a><br><a href="https://segmentfault.com/a/1190000014838704" target="_blank" rel="noopener">发npm</a><br><a href="https://juejin.im/post/5af7de01f265da0ba60fe37c" target="_blank" rel="noopener">发npm</a><br><a href="https://zhuanlan.zhihu.com/p/37316872" target="_blank" rel="noopener">发npm</a><br><a href="https://alili.tech/archive/i9t0x2tvleo/" target="_blank" rel="noopener">git hook</a><br><a href="https://juejin.im/post/5bf36163e51d45360069e0e8" target="_blank" rel="noopener">git hook</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuyongshun.github.io/2019/04/27/npm/" data-id="ckdcq6vuv0065d8cu87nzjgvi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NPM/">NPM</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/21/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/55/">55</a><a class="extend next" rel="next" href="/page/23/">下一页</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/">ES6</a><span class="category-list-count">13</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/array/">array</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/async/">async</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/class/">class</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/decorate/">decorate</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/export-import/">export&import</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/fuction/">fuction</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/generator/">generator</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/object/">object</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/promise/">promise</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/reflect/">reflect</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/set-map/">set&map</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/string/">string</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/variable-deconstruction/">variable&deconstruction</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/FLUTTER/">FLUTTER</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/FLUTTER/dart/">dart</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/FLUTTER/env/">env</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/H5/">H5</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/H5/h5-history/">h5 history</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/H5/h5-video/">h5 video</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVASCRIPT/">JAVASCRIPT</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVASCRIPT/变量/">变量</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/">JS</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JS/algorithm/">algorithm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/algorithm2/">algorithm2</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/data-constructor/">data constructor</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/principle/">principle</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/NODE/">NODE</a><span class="category-list-count">10</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/NODE/express/">express</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NODE/module/">module</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NODE/mongo/">mongo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NODE/mongoCommand/">mongoCommand</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NODE/mongoOprate/">mongoOprate</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NODE/mongoodb/">mongoodb</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NODE/node-api/">node api</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NODE/node-buffer/">node buffer</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NODE/node-stream/">node stream</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NODE/variable/">variable</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/NPM/">NPM</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/NPM/cli/">cli</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NPM/npm-package/">npm package</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/PLAY/">PLAY</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PLAY/eat/">eat</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PLAY/photo/">photo</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/REACT/">REACT</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/REACT/redux/">redux</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/TOOL/">TOOL</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/TOOL/chrome/">chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TOOL/chrome-perf/">chrome-perf</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TOOL/frequently/">frequently</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TOOL/git/">git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TOOL/mac/">mac</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TOOL/nginx/">nginx</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TOOL/vscode-plugin/">vscode plugin</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/VUE/">VUE</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/VUE/vueRouter/">vueRouter</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEBPACK/">WEBPACK</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WEBPACK/plugin/">plugin</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEBPACK/webpackDescription/">webpackDescription</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEBPACK/webpackMerge/">webpackMerge</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEEX/">WEEX</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WEEX/weex/">weex</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/multi-platform/">multi-platform</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/multi-platform/multi-platform/">multi-platform</a><span class="category-list-count">1</span></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/">ES6</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H5/">H5</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS/">JS</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NPM/">NPM</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REACT/">REACT</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cli/">cli</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/">es6</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flutter/">flutter</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/">mac</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/play/">play</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/">tool</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/variable/">variable</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/">vscode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/weex/">weex</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/ES6/" style="font-size: 10px;">ES6</a> <a href="/tags/H5/" style="font-size: 11.67px;">H5</a> <a href="/tags/JS/" style="font-size: 15px;">JS</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/NPM/" style="font-size: 11.67px;">NPM</a> <a href="/tags/REACT/" style="font-size: 10px;">REACT</a> <a href="/tags/cli/" style="font-size: 10px;">cli</a> <a href="/tags/es6/" style="font-size: 20px;">es6</a> <a href="/tags/flutter/" style="font-size: 13.33px;">flutter</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/node/" style="font-size: 18.33px;">node</a> <a href="/tags/play/" style="font-size: 11.67px;">play</a> <a href="/tags/tool/" style="font-size: 16.67px;">tool</a> <a href="/tags/variable/" style="font-size: 10px;">variable</a> <a href="/tags/vscode/" style="font-size: 10px;">vscode</a> <a href="/tags/vue/" style="font-size: 10px;">vue</a> <a href="/tags/webpack/" style="font-size: 15px;">webpack</a> <a href="/tags/weex/" style="font-size: 10px;">weex</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/04/19/REACT-redux/">redux &amp; react-redux</a>
          </li>
        
          <li>
            <a href="/2020/04/19/JS-data-constractor/">data constructor</a>
          </li>
        
          <li>
            <a href="/2020/03/27/tool-chrome-perf/">chrome-perf</a>
          </li>
        
          <li>
            <a href="/2020/03/19/paltform/">multi-platform</a>
          </li>
        
          <li>
            <a href="/2020/03/19/tool-chrome/">chrome</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <ul class="hobby-outer">
      <li class="hobby-item"><a href="http://blog.csdn.net/liuyongshun2/article">CSDN</a></li>
      <li class="hobby-item"><a href="https://github.com/liuyongshun">GITHUB</a></li>
    </ul>
    <div id="footer-info" class="inner">
      &copy; 2020 cheat&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1274642270'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1274642270%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>



    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/link" class="mobile-nav-link">链接</a>
  
</nav>
    

<script src="https://code.jquery.com/jquery-latest.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<div id="totop">
  <a title="javascript:;">返回<br>顶部</a>
</div>
<script src="/js/totop.js"></script>

  </div>
</body>
</html>